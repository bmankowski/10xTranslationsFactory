import { createSupabaseServerInstance } from "../../lib/auth";

export const prerender = false;

const url = Astro.url;
const code = url.searchParams.get('code');
const next = url.searchParams.get('next') || '/dashboard';

if (code) {
  const supabase = createSupabaseServerInstance({
    headers: Astro.request.headers,
    cookies: Astro.cookies
  });
  
  // Exchange the code for a session
  await supabase.auth.exchangeCodeForSession(code);
}

// Redirect to dashboard or specified next page
return Astro.redirect(next); 